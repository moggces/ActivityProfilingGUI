---
output: html_document
---
## A R Shiny interface to explore activity profiling data
The Curvep-wAUC pipeline identifies reproducible patterns in assays and interprets the results afterwards. Activities caused by known artifacts (e.g., cytotoxicity, quenching/autofluorescence) are labelled as inconclusive. An _active_ in in an assay may still need orthogonal assays to confirm its activity in the pathway and its relevance to human health.

### Requirement

* firefox or chrome browser with the link on NIEHS internal JOBS server [JOBS](http://jobs.niehs.nih.gov:3838/myapps/tox21actprofiler/) or Rstudio public Shiny server [shinyapps.io](https://hsiehjh.shinyapps.io/tox21actprofiler)

or

* download the shiny app from [ActivityProfilingGUI](https://github.com/moggces/ActivityProfilingGUI) and contact & contact [Jui-Hua Hsieh](mailto:juihua.hsieh@gmail.com) for background data


```{r eval=FALSE }
library(shiny)
runApp()
```

***

### Input
Two types of input are allowed: chemicals and data matrix

##### chemicals
1. creat two columns of data (i.e., chemical ID and its attribute) in excel
  + chemical ID: one type is allowed, **CAS**
      + CAS: Chemical Abstracts Service registration ID, e.g., 83-79-4
  + attribute: any class attribute associated with the chemical that could be compared with the in vitro qHTS data
2. create column names (case sensitive): **CAS** and **Cluster**
3. copy and paste to the text area

or the **Cluster** column is optional

###### Examples
CAS | Cluster
----| -------
83-79-4 | positive_zfish
80-05-7 | negative_zfish


##### data matrix
1. the downloaded activitiy data can be modified and re-uploaded (e.g., add an external assay results)
2. the file names have to contain **nwauc.logit|npod|nac50**. So it will recognize the type of activity and use respective coloring scheme. 
2. other data matrix with **CAS** as ID and comparable activity information can be uploaded (Note: data with CAS not available in Tox21 library will be excluded.).
3. **Cluster** information is optional.
4. **input_Chemical.Name** can be used to change the column names in the heatmap (optional).

###### Notes
* _Activity filtering_ function becomes invalid. 
* _Assay filtering_ function is still functional. 

***

### Profiling

##### signal
results observation, e.g., whether the compound causes increasing or decreasing signal

    * signal type
    currently only wauc is available, suitable for compound grouping
        
##### activity
results interpretation, e.g., whether the compound is active

    * activity type
        + wauc: overall effect of the chemical
        + pod: assay-dependent point-of-departure 
        + ac50: half-maximal effect concentration
    
###### activity type

type | value range | value description
-----|-------------| -----------------
wauc | 0 ~ 1 | higher value -> higher activity <br> 0 -> inactive <br> 1E-4 -> inconlusive
pod | log10(M)\*(-1) | higher value -> more potent <br> 1E-4 -> inconlusive <br> 0 -> inactive

ac50 type is same as pod type. 

***

### Activity filtering
The default activity results are based on Curvep-wAUC pipeline (i.e. known artifacts are excluded). But the activities can be **further** filtered by following parameters. 

* wAUC threshold: see above
* Emax threshold: half-maximal concentration (e.g., 30% relative to the positive control)
* POD threshold: see above
* AC50 threshold: see above
* log10(ratio of signal to cytotoxicity) (for inhibition-type assays): (e.g., 1 => 10 fold between signal and cytotoxicity).
* no cytotoxicity observed in tested concentration range (for inhibition-type assays): toggle ON to exclude any activity with cytotoxicity (information from the respective multiplexed assay) seen in the tested concentration range
* only curve class 1.1, 1.2, 2.1: toggle ON to include only activities from  two asymptote + strong/weak Emax + good fit or one asymptote + strong Emax + good fit in at least one run
* exclude high activity variation between sources: toggle OFF to include more potential activity. The included activities can still be recognized in the heatmap by the # sign
* exclude inconclusive label: ON makes all inconclusives (cytotoxic, artifacts) as inactives 

***

### Compound sorting
The columns of the heatmap can be ordered in three methods:

1. structure similarity
    + Tanimoto cofficient based on Leadscope structural fingerprints
    + hierarchical clustering with average linkage
    + chemicals are grouped by cutoff 0.7
    + a new parameter is created, chemClust, where chemClust = 0, are the compounds that cannot form clusters or compounds without structures
    
2. activity similarity
    + Euclidean distance based on respective activities
    + hierarchical clustering with average linkage
    
3. toxicity score (only for __activity__)
    + sum of the activities (unbounded, dependent on # of assasy used)
        + wauc: sum of wauc values
        + pod or ac50: sum of wauc-weighted pod or ac50 values (in data matrix input, sum of pod/ac50 values instead)

***

### Assay filtering

Please see the __Assays__ tab to get complete assay (common_name column) information

Simple regular expression rules:

1. how to get all specific assays
    + put _cytotoxicity_ in the text box plus toggle _ON_ invert your selection
2. how to get all antagonism or inhibition and specific assays
    + put antagonism\_|inhibition\_ in the text box plus toggle _OFF_ invert your selection (Note: _|_ means _OR_)
3. how to get all agonism and specific assays
    + put \\bagonism\_ in the text box plus toggle _OFF_ invert your selection

***


### Others

1. show the clustered dendrogram instead of the heatmap (toggle ON show compound similarity dendrogram)
2. limit the heatmap/potency plot in one page (toggle ON keep heatmap size one page)
3. adjust font size when downloading heatmap or online

  * Download Activities: If the data have not been released to PubChem, they will not be able to download
  * Save Plot (currently only for heatmap)

***

### Tabs

#### Input chemicals

If the input chemicals are not available, they will not have _GSID_. 
Current information is based on EPA DSSTOX. 

#### Profile

The heatmap will be displayed here. 

##### main map

* columns are compounds
* rows are assays
* cells are activities
* coloring scheme: please refer the color bar
* gray color: not tested. However if \"exclude inconclusive label\" ON, it could also mean _inconclusive_.

##### annotation map

* columns are compounds
* first row is toxScore (only available in __activity__)
* second row is userClust (__Cluster__)
* third row is chemCust

#### Potency plot

Only shown for pod or ac50 as activity.

#### Activity data 

background data used for heatmap and potency plot

#### Assays

assay information


***

### References

Curvep-wAUC pipeline: .Hsieh, J.-H. et al. A Data Analysis Pipeline Accounting for Artifacts in Tox21 Quantitative High-Throughput Screening Assays. J Biomol Screen 2015

contact [Jui-Hua Hsieh](mailto:juihua.hsieh@gmail.com) for more information 

***

### Troubleshooting

* Error: 'breaks' are not unique. It is possible that the input compounds are not active in any of the assays. Please add another compound (e.g. 80-05-7).
* my compound is missing on the heatmap. The compound may not be testesd or none of its sources passes the chemcial QC. 
